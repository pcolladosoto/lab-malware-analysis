#!/bin/sh

DEL_INC='/%include*/d'
TRIM_HDR='1d'
CONCAT_STR='%s\n%s\n'
FIXED_INC='%include "/home/malware/asm/joey_lib_io_v6_release.asm"\n'

for file in "$@"
do
	echo "Fixing $file"
	sed $DEL_INC $file | sed $TRIM_HDR > tmp.asm
	echo $FIXED_INC | cat - tmp.asm > $(echo $file | awk '{split($0, foo, "."); print foo[1]}')_fixed.asm
	rm tmp.asm
done
